Application of image processing algorithms for automated device positioning

## How it works for now

### mode detecting edges
![alt text fast9](https://github.com/vidkryvashka/esp32-cam-positioning/blob/main/demo/working.gif)\
#### algorithm experiments locally on laptop
![alt text fast9](https://github.com/vidkryvashka/esp32-cam-positioning/blob/main/demo/fast9_from_air.png)

### mode looking for sun: finds brightest points, filters it, detects middle point of them and x y angle to turn camera towards it.
![alt text look4sun](https://github.com/vidkryvashka/esp32-cam-positioning/blob/main/demo/look4sun.png)



# wtf

застаріле
## Дипломна робота на тему
# **Застосування алгоритмів обробки зображень для автоматичного позиціонування пристроїв**

## Опис

Розробляється прошивка для дешевого мікроконтролера з камерою **esp32-cam** під **FreeRTOS** з використанням розширення **PlatformIO** **VS Code**
та фреймворку **esp-idf** (набір крос компіляторів і бібліотек). Основна частина програмного коду написана мовою **C**.

## Поточна функціональність

- **Підключення до WiFi** з встановленням **mDNS hostname**, що дозволяє заходити на веб-сторінку пристрою через адресу `http://esp32.local/`.

- Створення **таску фотографера**, який періодично:

    - Робить знімок з камери.
    - Обробляє зображення одним з методів.
- Запуск власного **веб-сервера**, який хостить веб-сторінку

    - Надсилає фото на веб-інтерфейс разом з обчисленими даними для візуалізації.
    - Реалізовує можливість виділення мишкою прямокутної області на зображенні.
- Запуск менеджера сервоприводів
    - Наведення по куту визначеному методами обробки зображень.


## Обробка зображення

Тут на вибір один із двох підходів:

1. **Аналіз яскравості**:
    - Визначення області з найяскравішими пікселями і її центру.
    - Обчислення горизонтального і вертикального кутів від центру кадру до цього центру щоб камера могла навестись.
    - Позиціонування пристрою відбувається через сервоприводи, ще не підключено.

2. **Алгоритм FAST9**:
    - Визначення ключових точок (кутів контурів) на зображенні.
    - Використовується як основа для потенційного розширення до алгоритму **ORB (Oriented Rotated BRIEF)** (все ще не реалізовано)
        Врешті вдалось переписати FAST9 (визначення ключових точок) із **OpenCV (C++ STL)** на **C** й прикрутити до **esp32**.

Веб-сторінка відображає отримані координати поверх зображення.

###  **Наведення**
Використовуються 2 сервоприводи sg-90 для позиціонування **esp32-cam** по кутах вертикалі й горизонталі. Зібрана відповідна конструкція, працює

## Перспективи
Наступні етапи спробувати втілити автоматичне розпізнавання дронів, ПТУРів.
Часто фон не надто міняється, а ось коли на ньому починає різкіше переміщатись група ключових точок, стає підозріло.
В разі обирання цього напрямку не знадобиться далі імплементовувати решту алгоритму ORB

# Труднощі
Собака закопана у мові **C**, паралельному програмуванні на кількох потоках поверх двох ядер мікроконтролера.
Часто баги проявляються зовсім не одразу й відслідковувати роботу програми доволі складно але й цікаво